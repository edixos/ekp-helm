groups:
  - name: kubevirt.rules
    interval: 30s
    rules:
      - alert: KubeVirtComponentDown
        annotations:
          summary: "KubeVirt component is down"
          description: "KubeVirt component {{ $labels.pod }} in namespace {{ $labels.namespace }} is not available."
        expr: |
          up{namespace="kubevirt",pod=~"virt-.*"} == 0
        for: 5m
        labels:
          severity: critical

      - alert: KubeVirtVMIExcessiveMigrations
        annotations:
          summary: "VMI {{ $labels.name }} is migrating too frequently"
          description: "VirtualMachineInstance {{ $labels.name }} in namespace {{ $labels.namespace }} has migrated {{ $value }} times in the last hour."
        expr: |
          sum(increase(kubevirt_vmi_migration_succeeded[1h])) by (name, namespace) > 3
        for: 5m
        labels:
          severity: warning

      - alert: KubeVirtVMIHighMemoryUsage
        annotations:
          summary: "VMI {{ $labels.name }} has high memory usage"
          description: "VirtualMachineInstance {{ $labels.name }} in namespace {{ $labels.namespace }} is using {{ $value }}% of available memory."
        expr: |
          (kubevirt_vmi_memory_used_bytes / kubevirt_vmi_memory_available_bytes) * 100 > 90
        for: 10m
        labels:
          severity: warning

      - alert: KubeVirtNoAvailableNodesToRunVMs
        annotations:
          summary: "No available nodes to run VMs"
          description: "No nodes are available to schedule new VirtualMachineInstances."
        expr: |
          kubevirt_nodes_with_kvm == 0
        for: 5m
        labels:
          severity: critical
